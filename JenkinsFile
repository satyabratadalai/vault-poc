pipeline {
    agent any

    stages {
        stage('Fetch Secret') {
            steps {
                script {
                    // Initialize Vault access
                    def secrets = [
                        [$class: 'VaultSecret', path: 'mulesoft', secretValues: [
                            [$class: 'VaultSecretValue', envVar: 'MY_SECRET_USERNAME', vaultKey: 'username'],
                            [$class: 'VaultSecretValue', envVar: 'MY_SECRET_PASSWORD', vaultKey: 'password']
                        ]]
                    ]
                    echo "WORKING"
                    // Fetch secrets from Vault
                    withVault([vaultSecrets: secrets, vaultConfigurationId: 'vault-token']) {
                        // Directly print the environment variables
                        println("Username: " + System.getenv('MY_SECRET_USERNAME'))
                        println("Password: " + System.getenv('MY_SECRET_PASSWORD'))
                    }
                }
            }
        }
    }
}
