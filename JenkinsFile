pipeline {
    agent any

    environment {
        // Define variables for Vault secrets
        VAULT_SECRET = credentials('mule-vault')
    }

    stages {
        stage('Fetch Secret') {
            steps {
                script {
                    // Initialize Vault access
                    def secrets = [
                        [$class: 'VaultSecret', path: 'mulesoft', secretValues: [
                            [$class: 'VaultSecretValue', envVar: 'SECRET_KEY', vaultKey: 'key1'],
                            [$class: 'VaultSecretValue', envVar: 'ANOTHER_SECRET', vaultKey: 'key2']
                        ]]
                    ]

                    // Fetch secrets from Vault
                    withVault([vaultSecrets: secrets]) {
                        echo "Secret: ${env.SECRET_KEY}"
                        echo "Another Secret: ${env.ANOTHER_SECRET}"
                    }
                }
            }
        }
    }
}
